Я не знаю, як використовують твої знайомі, але тут так і проситься розділити інтерфейс та, наприклад, генерацію запитів. Це компонент Лазаруса, якщо що. Це так, що перше в очі впало. І тестів до цього коду я там не знайшов. Напевне, з цієї причини.

